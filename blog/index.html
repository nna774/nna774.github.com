<!doctype html> <html lang=ja prefix="og: http://ogp.me/ns#"> <head> <meta charset=utf-8 /> <title>/dev/nona (いっと☆わーくす！)</title> <link rel=alternate type="application/atom+xml" title="/dev/nona's Atom Feed" href="/blog/feed.xml"/> <link href="/css/default-92a9bce0.css" rel=stylesheet /><link href="/css/blog-344a15e1.css" rel=stylesheet /> <script src="/js/tweet-cd4970cb.js"></script> <link rel="shortcut icon" href="/favicon.ico" type="image/vnd.microsoft.icon"> <link rel=icon href="/favicon.ico" type="image/vnd.microsoft.icon"> <link rel=canonical href="https://nna774.net/blog/"/> <meta property="og:type" content=website /> <meta name="twitter:card" content=summary> <meta name="twitter:site" content="@nonamea774"> <meta name="twitter:url" content="https://nna774.net/blog/"> <meta name="twitter:domain" content="nna774.net"> <meta name="twitter:creator" content="@nonamea774"> <meta property="og:title" content="/dev/nona (いっと☆わーくす！)"/> <meta property="og:url" content="https://nna774.net/blog/"/> <meta property="og:image" content="https://nna774.net/img/1012-ogp.png"/> <meta property="og:description" content="いっと☆わーくす！"/> <script>var _gaq=_gaq||[];_gaq.push(['_setAccount','UA-48827029-1']);_gaq.push(['_trackPageview']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=1;ga.src='https://stats.g.doubleclick.net/dc.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();</script> </head> <body> <header role=banner id=head> <div id=banner> <h1><a href="/blog/" rel=index>/dev/nona (いっと☆わーくす！)</a></h1> <p id=1point>あなたの予想に反して、このページが見えているでしょうか? </p> <p id=pBar>[##--------] 28%</p> <nav id=headerMenu> <a href="/" rel=up>top</a> <a href="/blog/feed.xml" rel=alternate>feed</a> </nav> </div> <div id=img> <a href="/blog/" rel=index><img src="/img/1012.webp" width=160px height=150px alt="nona's icon.[If you can't see this image, use Google Chrome, Opera or browser that support WebP. ...Or see /img/1012.png.]"/></a> </div> </header> <div id=wrap> <main role=main> <p class=pageChain> <a href="/blog/page/2/" rel=next>過去のページ</a> Page 1 of 4 <a>未来のページ</a> </p> <article title="2048-AI コンテスト 第二回"> <header class=articleMeta> <h1 class=articleTitle><a href="/blog/2014/06/09/2048.html">2048-AI コンテスト 第二回</a></h1> <time datetime="2014-06-09T19:26+0900">2014/06/09 19:26</time> <a rel=author href="/about">NoNameA 774</a> <a href="/blog/2014/06/09/2048.html">parmalink</a> <span class=tags> Tags: <a href="/blog/tags/2048.html" rel=tag>2048</a> </span> </header> <p>2048 AI コンテストの第二回があった。</p> <p>今回の私の出場した際のソースコードは<a href="https://github.com/nna774/2048-cpp/tree/562d483df79d70a3e18cd4afa74e5d7385345c99">これ</a> です。</p> <p>今回は三位でした。</p> <p>前回の時と比べて、かなりの高速化を図れたので、10手読みまで行くことが可能となった(前回は6手読みだった)。</p> <p>Grid を前回はstd::array&lt;std::array&lt;int, 4&gt;, 4&gt; だったが、64bit int 一つで16個のGrid を表わすようにして、色々な操作を謎のbit 演算にすることでかなり高速になった。</p> <p>謎のbit 演算が沢山でてきて辛かったので、Google Test も導入した。</p> <p>10手まで読めるようになったことによって、4096 まで作れるようになった。</p> <p>まだ100〜1000回に一回程度しか8192 を作ってくれない。</p> <p>GA も実装しないと。</p> <h1 id=ref>ref</h1> <ul> <li>2048AIコンテスト 第2回 - KMC活動ブログ <a href="http://kmc.hatenablog.jp/entry/2014/06/09/032439">http://kmc.hatenablog.jp/entry/2014/06/09/032439</a></li> <li>2048のAIを書かなかった話。あるいは遺伝的プログラミングの話 - @Angelworm_とは <a href="http://angelworm.hatenablog.com/entry/2014/06/07/024027">http://angelworm.hatenablog.com/entry/2014/06/07/024027</a></li> </ul> </article> <article title="Google による検閲行為"> <header class=articleMeta> <h1 class=articleTitle><a href="/blog/2014/06/08/google.html">Google による検閲行為</a></h1> <time datetime="2014-06-08T03:51+0900">2014/06/08 03:51</time> <a rel=author href="/about">NoNameA 774</a> <a href="/blog/2014/06/08/google.html">parmalink</a> <span class=tags> Tags: <a href="/blog/tags/google.html" rel=tag>Google</a> </span> </header> <p>Google が検索結果に対する検閲行為を始めたらしい。</p> <blockquote class=twitter-tweet lang=ja><p>bingとbaiduの「ロリ漫画」での検索結果は正常。&#10;一方Googleではわずか17件しかヒットしない。&#10;もはやGoogleは正確な検索結果を欲する人にとっての最適解ではなくなりました。 <a href="http://t.co/fMnxB98ZDc">pic.twitter.com/fMnxB98ZDc</a></p>&mdash; ロリ漫画.com (@lolimangacom) <a href="https://twitter.com/lolimangacom/statuses/475244382929444864">2014, 6月 7</a></blockquote> <script async="" src="//platform.twitter.com/widgets.js" charset=utf-8></script> <blockquote class=twitter-tweet lang=ja><p>Googleで「ロリ」と検索してみれば分かりますが、ごっそりと検索結果が除外され、20件程度しか表示されません。&#10;&#10;行政ではないとはいえ、大きなシェアを獲得している企業が、絶対に禁止(憲法21条2項)されている検閲同然の行為を行うことは残念極まりないです。</p>&mdash; ロリ漫画.com (@lolimangacom) <a href="https://twitter.com/lolimangacom/statuses/475242649620733952">2014, 6月 7</a></blockquote> <blockquote class=twitter-tweet lang=ja><p>Googleが八部だけでなく、ロリ系ワードの検閲を始めたようです。&#10;&#10;ろりともだちの皆様は、『bing』や『百度』といった検索サービスを使うことをオススメします。&#10;&#10;ロリ漫画.comも当然検索できます。</p>&mdash; ロリ漫画.com (@lolimangacom) <a href="https://twitter.com/lolimangacom/statuses/475241686876946433">2014, 6月 7</a></blockquote> <script async="" src="//platform.twitter.com/widgets.js" charset=utf-8></script> <blockquote class=twitter-tweet lang=ja><p>えー「ロリコン」で検索してWikiepdiaの「ロリータ・コンプレックス」の項へ到達できないとか、マジに頭の悪過ぎる誰得チューニングなんですけど。Googleさんは、本当に自分達が何をやっているか、どれだけものすごいことをやらかしているか、分かってるんでしょーか？</p>&mdash; Yuzuru Nakagawa (@mishiki) <a href="https://twitter.com/mishiki/statuses/475301011288895488">2014, 6月 7</a></blockquote> <p>実際、Google検索で、「ロリコン」で検索しても、まともな内容のページは結果に出ず、使いものにならないようになっている。</p> <p>「ロリ」で検索した時の結果がこれである。<br/> <img alt="「ロリ」検索結果" src="/blog/2014/06/08/loli.png"/><br/></p> <p> この検閲について、Google で検索した際の結果はよりひどい。<br/> <img alt="「Google 検索 ロリ」検索結果" src="/blog/2014/06/08/googleLoli.png"/> <br/> 「どのような検閲が行われているか」を検索することすら難しいのだ。<br/> <blockquote class=twitter-tweet lang=ja><p>Google が検閲を行っていると書いてあるサイトが今度はGoogle から消され, さらにそれに言及したページも消され, 健全な市民はGoogle による検閲行為など全く誰も知らないセカイ</p>&mdash; 駆逐艦のな改ぜろ[43/---] ##% (@nonamea774) <a href="https://twitter.com/nonamea774/statuses/475343713854451713">2014, 6月 7</a></blockquote> <blockquote class=twitter-tweet lang=ja><p>まあ俺は、私企業たる検索エンジン運営者が「ロリ」での検索結果を自粛するのは、アリちゃーアリだと思っている。でも、「ロリ 規制 google」での検索結果の質が極めて悪いのというのはいただけない。こういう検索結果の質を改善しない「自粛」なら、Google は Evil だ。</p>&mdash; Yuzuru Nakagawa (@mishiki) <a href="https://twitter.com/mishiki/statuses/475293036784541697">2014, 6月 7</a></blockquote> </p> <p> <strong>「この検閲行為を、「ロリ」のフィルターだから問題無いか」と考えることは危険である</strong><br/> <blockquote class=twitter-tweet lang=ja><p>彼等は次にロリを攻撃した。しかし、私は沈黙していた。&#10;私はロリコンではなかったから。&#10;&#10;ある日、彼等は私のもとにやって来た。その時、私は初めて彼等に抗議した。&#10;しかし、その時には、何もかもが遅かった。</p>&mdash; 兄の要望で脱毛サロン通ってたんですぅ (@hidesys) <a href="https://twitter.com/hidesys/statuses/475307687459049472">2014, 6月 7</a></blockquote> </p> <p>引き続きどうなるかを観察しておかないといけない案件なのでとりあえずメモまでに。</p> <h2 id=ref>ref</h2> <ul> <li>googleがロリエロ八分を実行したとの説 <a href="http://togetter.com/li/677379">http://togetter.com/li/677379</a></li> <li>【時事】Google検索の未成年関係のワード規制まとめ <a href="http://yojonovel.blog.fc2.com/blog-entry-95.html">http://yojonovel.blog.fc2.com/blog-entry-95.html</a></li> <li>Twitter / mishiki: Googleが、判断基準の透明性のまるでない恣意的な情報の選別を行いますと宣言しているのなら、…<a href="https://twitter.com/mishiki/status/475295821034844160">https://twitter.com/mishiki/status/475295821034844160</a></li> <li>Twitter / otakutokkai: 「ロリ」と入力して検索すると，最初の画面では… <a href="https://twitter.com/otakutokkai/status/475221510202740736">https://twitter.com/otakutokkai/status/475221510202740736</a></li> <li>【悲報】Google検索で 二次ロリ 規制はじまる 【2chまとめ】ニュース速報嫌儲板 <a href="http://newskenm.blog.fc2.com/blog-entry-18648.html">http://newskenm.blog.fc2.com/blog-entry-18648.html</a></li> </ul> </article> <article title="Google Test"> <header class=articleMeta> <h1 class=articleTitle><a href="/blog/2014/05/31/googletest.html">Google Test</a></h1> <time datetime="2014-05-31T04:35+0900">2014/05/31 04:35</time> <a rel=author href="/about">NoNameA 774</a> <a href="/blog/2014/05/31/googletest.html">parmalink</a> <span class=tags> Tags: <a href="/blog/tags/2048.html" rel=tag>2048</a> <a href="/blog/tags/ci.html" rel=tag>CI</a> </span> </header> <p><a href="https://github.com/nna774/2048-cpp">2048AI</a> の内部で、謎のbit 演算がたくさん使われてきて辛くなってきた。</p> <p>どっか間違えててもまずわからないと思う。</p> <p>というわけでテストを書きたいなーと思ったので、いい感じのC++ のテストツールがないか聞いてみたところ、Google Test を教えてもらった。</p> <p><a href="http://minus9d.hatenablog.com/entry/20140119/1390117516">ここ</a> を見ながら適当に設定すればいい感じになった。</p> <p>Google Test のコードを<a href="https://code.google.com/p/googletest/">ここ</a> からダウンロードしてきて、解凍。解凍後 gtest-1.7.0 に移動し、</p> <pre><code>$ ./configure
$ make 
</code></pre> <p>これで準備完了。依存しているテストツールのヴァージョンが異なるとややこしいので、システムにはインストールしないほうがいいらしい。</p> <p>googletest のmake ディレクトリ以下を参考にしてMakefile を書けばいいかんじに動くようになった。</p> <p>CI ツールで以下のようなコマンドを走らせてtest している。</p> <pre><code>git submodule init
git submodule update
cd test
unzip gtest-1.7.0.zip &gt; /dev/null
cd gtest-1.7.0
./configure &gt; /dev/null
make &gt; /dev/null
cd ../../
make OPT="-O3 -pipe"
make test
</code></pre> <p>こんな感じでテストが走ってる。</p> <pre><code>[==========] Running 4 tests from 1 test case.
[----------] Global test environment set-up.
[----------] 4 tests from BoardTest
[ RUN      ] BoardTest.log2
[       OK ] BoardTest.log2 (0 ms)
[ RUN      ] BoardTest.pow2
[       OK ] BoardTest.pow2 (0 ms)
[ RUN      ] BoardTest.gridMirrorIDRAND
[       OK ] BoardTest.gridMirrorIDRAND (0 ms)
[ RUN      ] BoardTest.popCountRAND
[       OK ] BoardTest.popCountRAND (1 ms)
[----------] 4 tests from BoardTest (2 ms total)

[----------] Global test environment tear-down
[==========] 4 tests from 1 test case ran. (2 ms total)
[  PASSED  ] 4 tests.
</code></pre> <p>ちゃんとテストを書かないと。</p> </article> <article title="たまこラブストーリーを見た"> <header class=articleMeta> <h1 class=articleTitle><a href="/blog/2014/05/22/tamako.html">たまこラブストーリーを見た</a></h1> <time datetime="2014-05-22T03:28+0900">2014/05/22 03:28</time> <a rel=author href="/about">NoNameA 774</a> <a href="/blog/2014/05/22/tamako.html">parmalink</a> <span class=tags> Tags: <a href="/blog/tags/dev-null.html" rel=tag>/dev/null</a> <a href="/blog/tags/日常.html" rel=tag>日常</a> </span> </header> <p>たまこラブストーリーを見にいった。京都ではMOVIX でしか上映されていないので、寺町通まで行って見た。</p> <h1 id=section>一応ネタバレ注意？</h1> <p>いい話だった。いい映画だった。</p> <p>たまこの«光» とまで言われる程だ。</p> <p>アニメを復習したくなった。</p> <h2 id=section-1>大まかに</h2> <p>みんなが"変化" していく話であった。 つらかった。</p> <p>もち蔵は東京の大学に行くし、栞さんは海外に留学しようとする。そもそもみんなは高校3年生で、"卒業" という言葉がつきまとう。</p> <p>個人的に一番印象的だったのは、あんこが中学校の制服を着るシーンだった。 あのシーンは「この世界にも永遠は無いのだなぁ」 という気持ちになった。</p> <p>だれも「ここにあるよ」 とは言ってくれない。</p> <h2 id=gj->GJ部 もそうだった</h2> <p>最近ぐるぐるの放送があったので見直したのだが、あの作品は、1話から11話までは特に話に進行もなにもなく進むのだが、12話で先輩たちが卒業してしまう回がある。</p> <p>リピートディスクという物がGJ部には存在するのだが、それが2種類のメニューがディスクを再生すると選べて、「1話から12話をリピートする」 というものと、「1話から11話をリピートする」 というものがある。</p> <p>12話の卒業などという永遠の世界から外れたものを見ないための措置であると思う。</p> <h2 id=section-2>私は</h2> <p>私は何事も変化してほしくない。</p> <p>変化するということは壊れてしまう、という事でもある。</p> <p>完全に静止した世界(最早それを世界と言っていいのかわからないが) に住みたい。</p> <h3 id=nona->だからnona が産まれた？</h3> <p>nona は環境を含んだクロージャである。と言っても良いと思う。</p> <p>物理的な私は現実世界に制約されてしまうが、その上で動く人格であるnona はその制約を無視して変化しない世界に逃げこめす。</p> <p>どうでもいいですね。</p> <h1 id=section-3>まとめ</h1> <p><em><b> たまこラブストーリー良かったから見よう！！！ </b></em></p> <p>映画見て帰り道に浮き石を通って帰った。こういう時に現地周辺に住んでると嬉しい。</p> </article> <article title="2048AI の進捗状況です。"> <header class=articleMeta> <h1 class=articleTitle><a href="/blog/2014/05/19/2048.html">2048AI の進捗状況です。</a></h1> <time datetime="2014-05-19T03:25+0900">2014/05/19 03:25</time> <a rel=author href="/about">NoNameA 774</a> <a href="/blog/2014/05/19/2048.html">parmalink</a> <span class=tags> Tags: <a href="/blog/tags/2048.html" rel=tag>2048</a> </span> </header> <p>タイトル通り2048AI の進捗状況です。</p> <p><img alt="" src="/blog/2014/05/19/grid.png"/></p> <p><a href="https://github.com/nna774/2048-cpp/tree/4a4c432e56b61984d6edd42269694e4bd0eebd80">現在のソースコード</a></p> <ul> <li> <p>高速化 grid を今まではstd::array&lt;std::array&lt;int,4&gt;,4&gt; でもっていたが、uint64_t で持つようにした。 それだけで大分速くなった気がする。</p> </li> <li> <p>世界と分離 koyone は思考をし、世界は盤面の状態を持つだけにきちんと分離できた。他の思考用class を用意して差し替えることが簡単にできるようになった。</p> </li> <li> <p>探索面 一手後の世界を予想する時に、ナイーブにするなら動かした後に開いてるマスに2 か4 を入れるが、開いてるマスすべてに2 を入れて読めば若干良くなるという話を聞いたので試してみた。それがKoyoneNext だ。</p> </li> </ul> <h2 id=section>思考クラスたち</h2> <h3 id=koyone>Koyone</h3> <p>単純にある程度の深さまで全探索を試みる。 評価関数はグリッド上の数字について、その数字にその数字のlog2 をとったものを掛けてたものの和。 それが一番大きくなるものの存在する方向に動かす。 <a href="https://nna774.net/blog/2014/05/13/2048.html">前回</a> の時の思考はこれだった。</p> <h3 id=koyonenext>KoyoneNext</h3> <p>基本的にはKoyone と同じ。nextPossibleWorld だけを上記のように変更してある。 ちょっと以前のより強くなった。</p> <h3 id=kihime>Kihime</h3> <p>モンテカルロによる探索を実装しようとしてまだ中身は空だ。</p> </article> <article title="nginx に移行していた"> <header class=articleMeta> <h1 class=articleTitle><a href="/blog/2014/05/13/nginx.html">nginx に移行していた</a></h1> <time datetime="2014-05-13T11:46+0900">2014/05/13 11:46</time> <a rel=author href="/about">NoNameA 774</a> <a href="/blog/2014/05/13/nginx.html">parmalink</a> <span class=tags> Tags: <a href="/blog/tags/raspberry-pi.html" rel=tag>Raspberry Pi</a> <a href="/blog/tags/spdy.html" rel=tag>SPDY</a> <a href="/blog/tags/ssl.html" rel=tag>SSL</a> </span> </header> <p>HeartBleed の時にRaspberry Pi のOS をArch に変えたので、nginx 1.6 が簡単に使えるみたいだったので、乗りかえた。</p> <p>nginx 1.6 ではなんとデフォルトでSPDY に対応している！</p> <p>というわけでnna774.net もSPDY に対応しました。</p> <p>quic も試してみたいけれど、まだ対応してるものは無いっぽい？ですね……</p> </article> <article title="2048-AI コンテスト"> <header class=articleMeta> <h1 class=articleTitle><a href="/blog/2014/05/13/2048.html">2048-AI コンテスト</a></h1> <time datetime="2014-05-13T01:49+0900">2014/05/13 01:49</time> <a rel=author href="/about">NoNameA 774</a> <a href="/blog/2014/05/13/2048.html">parmalink</a> <span class=tags> Tags: <a href="/blog/tags/2048.html" rel=tag>2048</a> <a href="/blog/tags/kmc.html" rel=tag>KMC</a> </span> </header> <p>KMC で2048 のAI の強さを競うコンテストがあった。</p> <p>2048 as a Servise を使ってたたかうもので、言語や環境等は自由であった。</p> <p>まず始めにruby のサンプルコードを書いた。<a href="https://github.com/nna774/2048-ruby/tree/randomMove">サンプルコード</a></p> <p>そのまましばらくruby で書きつづけていた(mikutter のプラグイン以外でruby を書くのは初めてだった)。 このへんまで書いた。 <a href="https://github.com/nna774/2048-ruby">nna774/2048-ruby</a></p> <p>ナイーブに全探索を数手先までしているようなかんじだった。</p> <p>どうにも遅かったのでC++ で書きなおした。実際に使ったのが<a href="https://github.com/nna774/2048-cpp/tree/512/">これ</a> です。モンテカルロも実装しかけてたけど、バグバグだったのであきらめた。レポジトリは<a href="https://github.com/nna774/2048-cpp">ココ</a>。 名前はkoyone です。</p> <p>結果はこんな感じ。</p> <p><img alt="" src="/blog/2014/05/13/rank.png"/></p> <p>かろうじて5位でした。</p> <p>もっと次回までには強くしないといけない。</p> <p>次回コンテストは6/4。 それまでに強化しよう……</p> <h1 id=ref>ref</h1> <p><a href="http://kmc.hatenablog.jp/entry/2014/05/12/021050">2048AIコンテストを開催します！ - KMC活動ブログ</a></p> </article> <article title=lifepng> <header class=articleMeta> <h1 class=articleTitle><a href="/blog/2014/04/25/lifepng.html">lifepng</a></h1> <time datetime="2014-04-25T01:11+0900">2014/04/25 01:11</time> <a rel=author href="/about">NoNameA 774</a> <a href="/blog/2014/04/25/lifepng.html">parmalink</a> <span class=tags> Tags: <a href="/blog/tags/javascript.html" rel=tag>JavaScript</a> <a href="/blog/tags/lifegame.html" rel=tag>LifeGame</a> </span> </header> <p><a href="https://nna774.net/lifepng/">LifePNG</a> を作った。 <a href="https://github.com/nna774/lifepng">Github レポジトリ</a></p> <p><img alt="グライダー" src="/img/glider.png"/> こんな画像を簡単に作れるようなやつです。</p> <p><img alt="時計2 - Gif Animation" src="/img/life/clock2.gif"/> こんなのもできる。</p> <p>くわしくは<a href="https://github.com/nna774/lifepng">Github レポジトリ</a> を参照してください。</p> </article> <article title="ミッドナイト念仏に行った"> <header class=articleMeta> <h1 class=articleTitle><a href="/blog/2014/04/20/nidnight.html">ミッドナイト念仏に行った</a></h1> <time datetime="2014-04-20T01:34+0900">2014/04/20 01:34</time> <a rel=author href="/about">NoNameA 774</a> <a href="/blog/2014/04/20/nidnight.html">parmalink</a> <span class=tags> Tags: <a href="/blog/tags/日常.html" rel=tag>日常</a> </span> </header> <p>昨日(暦としては18日の夜)、ミッドナイト念仏に行った。</p> <h1 id=is->is 何</h1> <p><a href="http://www.chion-in.or.jp/03_gyoji/tei/gyok.html">公式ページ</a></p> <p>知恩院で行なわれる法然上人の法要のイベント(?) のうちの一つである。</p> <iframe src="https://www.flickr.com/photos/nna774/13902685426/in/set-72157644071467422/player/" width=500 height=375 frameborder=0 allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen="" oallowfullscreen="" msallowfullscreen=""></iframe> <p><a href="https://www.flickr.com/photos/nna774/sets/72157644071467422/">set</a></p> <p>夜通し木魚を叩きつづけるイベントである(こんなふうに書いたら怒られそうだ)。</p> <p>普段は入れない知恩院三門に入ることができるイベントでもある。</p> <h1 id=beat>かなり低く見積っても数万回のBeat</h1> <p>三時ぐらいに知恩院に行って朝まで木魚を叩きつづけた。</p> <p>中で撮影は禁止されていたけれど、特に録音は禁止されてなかったので、すこしだけ録音した。</p> <p><a href="/blog/2014/04/20/nenbutsu.ogg">nenbutsu.ogg</a></p> <iframe width="100%" height=166 scrolling=no frameborder=no src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/145490050&amp;color=ff5500&amp;auto_play=false&amp;hide_related=false&amp;show_artwork=true"></iframe> <p>謎のトランス感のあるイベントであった。</p> </article> <article title=mod_rewrite> <header class=articleMeta> <h1 class=articleTitle><a href="/blog/2014/04/10/mod_rewrite.html">mod_rewrite</a></h1> <time datetime="2014-04-10T00:39+0900">2014/04/10 00:39</time> <a rel=author href="/about">NoNameA 774</a> <a href="/blog/2014/04/10/mod_rewrite.html">parmalink</a> <span class=tags> Tags: <a href="/blog/tags/blog.html" rel=tag>Blog</a> </span> </header> <p>現状、このページは、静的html等は事前にgzip で圧縮して、それをmod_rewrite でいいかんじにURL を書きかえてAccept-Encoding: gzip があればgzip版を返すよう設定してある。 ……と思ってたんだけれども、Accept-Encoding: gzip がついてなくても、gzip で返したり、対応するgz ファイルが存在しないと404 になったりしていた。</p> <pre><code>RewriteCond %{HTTP:Accept-encoding} gzip
RewriteCond %{REQUEST_FILENAME}.gz -f
RewriteRule ^(.*)\.css$ $1.css.gz [QSA,L]
RewriteRule ^(.*)\.js$ $1.js.gz [QSA,L]
RewriteRule ^(.*)\.html$ $1.html.gz [QSA,L]
</code></pre> <p>のように書いていた。</p> <p>調べていると、結局、RewriteCond が影響するのは、次のRewriteRule だけであることがわかった。 それでAccept-Encoding: gzip のないindex.html へのアクセスにもgzip圧縮されたものを返したり、index.html.gz がないと404 になったりしていたのだ。</p> <pre><code>RewriteCond %{HTTP:Accept-encoding} gzip
RewriteCond %{REQUEST_FILENAME}.gz -f
RewriteRule ^(.*)\.css$ $1.css.gz [QSA,L]
RewriteCond %{HTTP:Accept-encoding} gzip
RewriteCond %{REQUEST_FILENAME}.gz -f
RewriteRule ^(.*)\.js$ $1.js.gz [QSA,L]
RewriteCond %{HTTP:Accept-encoding} gzip
RewriteCond %{REQUEST_FILENAME}.gz -f
RewriteRule ^(.*)\.html$ $1.html.gz [QSA,L]
</code></pre> <p>のように書きなおした現在、期待どうりの挙動をしているように見える。</p> </article> <p class=pageChain> <a href="/blog/page/2/" rel=next>過去のページ</a> Page 1 of 4 <a>未来のページ</a> </p> </main> <aside id=sideBar> <h2>Recent Articles</h2> <ol> <li><a href="/blog/2014/06/09/2048.html">2048-AI コンテスト 第二回</a><wbr> <time datetime="2014-06-09T19:26+0900">Jun 9</time></li> <li><a href="/blog/2014/06/08/google.html">Google による検閲行為</a><wbr> <time datetime="2014-06-08T03:51+0900">Jun 8</time></li> <li><a href="/blog/2014/05/31/googletest.html">Google Test</a><wbr> <time datetime="2014-05-31T04:35+0900">May 31</time></li> <li><a href="/blog/2014/05/22/tamako.html">たまこラブストーリーを見た</a><wbr> <time datetime="2014-05-22T03:28+0900">May 22</time></li> <li><a href="/blog/2014/05/19/2048.html">2048AI の進捗状況です。</a><wbr> <time datetime="2014-05-19T03:25+0900">May 19</time></li> <li><a href="/blog/2014/05/13/nginx.html">nginx に移行していた</a><wbr> <time datetime="2014-05-13T11:46+0900">May 13</time></li> <li><a href="/blog/2014/05/13/2048.html">2048-AI コンテスト</a><wbr> <time datetime="2014-05-13T01:49+0900">May 13</time></li> <li><a href="/blog/2014/04/25/lifepng.html">lifepng</a><wbr> <time datetime="2014-04-25T01:11+0900">Apr 25</time></li> <li><a href="/blog/2014/04/20/nidnight.html">ミッドナイト念仏に行った</a><wbr> <time datetime="2014-04-20T01:34+0900">Apr 20</time></li> <li><a href="/blog/2014/04/10/mod_rewrite.html">mod_rewrite</a><wbr> <time datetime="2014-04-10T00:39+0900">Apr 10</time></li> </ol> <h2><a href="/blog/tags/">Tags</a></h2> <ul> <li><a href="/blog/tags/ssl.html">SSL</a> (6)</li> <li><a href="/blog/tags/日常.html">日常</a> (5)</li> <li><a href="/blog/tags/2048.html">2048</a> (4)</li> <li><a href="/blog/tags/spdy.html">SPDY</a> (4)</li> <li><a href="/blog/tags/kmc.html">KMC</a> (4)</li> <li><a href="/blog/tags/kancolle.html">Kancolle</a> (3)</li> <li><a href="/blog/tags/gr-sakura.html">GR-SAKURA</a> (3)</li> <li><a href="/blog/tags/ci.html">CI</a> (3)</li> <li><a href="/blog/tags/raspberry-pi.html">Raspberry Pi</a> (3)</li> <li><a href="/blog/tags/blog.html">Blog</a> (3)</li> <li><a href="/blog/tags/gcc.html">GCC</a> (3)</li> <li><a href="/blog/tags/jenkins.html">Jenkins</a> (2)</li> <li><a href="/blog/tags/middleman.html">Middleman</a> (2)</li> <li><a href="/blog/tags/foursquare.html">Foursquare</a> (1)</li> <li><a href="/blog/tags/git.html">Git</a> (1)</li> <li><a href="/blog/tags/chrome.html">Chrome</a> (1)</li> <li><a href="/blog/tags/kernelvm.html">KernelVM</a> (1)</li> <li><a href="/blog/tags/gpg.html">GPG</a> (1)</li> <li><a href="/blog/tags/anime.html">Anime</a> (1)</li> <li><a href="/blog/tags/javascript.html">JavaScript</a> (1)</li> <li><a href="/blog/tags/openstack.html">OpenStack</a> (1)</li> <li><a href="/blog/tags/lifegame.html">LifeGame</a> (1)</li> <li><a href="/blog/tags/ghc.html">GHC</a> (1)</li> <li><a href="/blog/tags/clang.html">Clang</a> (1)</li> <li><a href="/blog/tags/dev-null.html">/dev/null</a> (1)</li> <li><a href="/blog/tags/starbound.html">Starbound</a> (1)</li> <li><a href="/blog/tags/google.html">Google</a> (1)</li> <li><a href="/blog/tags/email.html">Email</a> (1)</li> </ul> <h2>Archive</h2> <ul> <li> <a href="/blog/2014.html" rel=archive> 2014 </a> <ul> <li><a href="/blog/2014/06.html" rel=archive>Jun</a>(2)</li> <li><a href="/blog/2014/05.html" rel=archive>May</a>(5)</li> <li><a href="/blog/2014/04.html" rel=archive>Apr</a>(5)</li> <li><a href="/blog/2014/03.html" rel=archive>Mar</a>(8)</li> <li><a href="/blog/2014/02.html" rel=archive>Feb</a>(17)</li> </ul> </li> </ul> <div id=license> <h2>LICENSE</h2> <p> Unless otherwise noted, <br/> Copyright (C) 2014- NoNameA 774(NNN77) <br/> Permission is granted to copy, distribute and/or modify this document under the terms of <a rel=license href="https://www.gnu.org/licenses/fdl.html">the GNU Free Documentation License, Version 1.3 or any later version</a> published by the Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts. <br/> ただし、必要である範囲において他の著作物を引用していることがあります。 </p> <p> <a rel=license href="https://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="/img/cc-by-sa_88x31.png" width=88 height=31 /></a><br/>And, this work is licensed under a <a rel=license href="https://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a> or <a rel=license href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a>. </p> </div> </aside> </div> <footer> <address> NoNameA 774 (<a href="https://twitter.com/nonamea774" rel=me>nonamea774</a>@nnn77) &lt;<a href="mailto:nonamea774@gmail.com" rel=me>nonamea774@gmail.com</a>&gt;<br/> KeyID: <a href="http://pgp.nic.ad.jp/pks/lookup?op=index&amp;search=0x0C3E3AB2&amp;fingerprint=on">0x0C3E3AB2</a><br/> <a href="https://gist.github.com/nna774/8337711">fingerprint: 674A 287A 21D2 2431 AD8F D328 AEF3 C3C7 0C3E 3AB2</a> </address> </footer> </body> </html>